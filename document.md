# Lunar开发文档

## 1 博客

### 1.1 博客查询

#### 1.1.1 接口设计

| URL            | 请求类型 | 是否需要token |
| -------------- | -------- | ------------- |
| /blog/{blogId} | GET      | 不需要        |

#### 1.1.2 需求分析

传入GET请求，返回编号为{blogId}的博客的

- 博客编号
- 博客作者编号
- 博客作者姓名
- 博客内容
- 博客标题
- 博客创建时间
- 博客被查看的次数
- 博客被点赞的次数
- 博客被点踩的次数
- 博客被收藏的次数
- 博客被分享的次数
- 博客的可见性
- 博客的类型
- 博客的标签列表

调用接口时，博客的被查看次数增加1。

#### 1.1.3  代码实现

### 1.2 热门博客列表查询

#### 1.2.1 接口设计

| URL       | 请求类型 | 是否需要token |
| --------- | -------- | ------------- |
| /blog/hot | GET      | 不需要        |

#### 1.2.2 需求分析

展示所有公开（可见性为0）博客中访问量最多的博客的

- 博客编号
- 博客作者编号
- 博客作者姓名
- 博客标题
- 博客摘要
- 博客的创建时间
- 博客的标签列表

分页查询（不传pageNumber和pageSize默认查询第1页前10个）

#### 1.2.3 代码实现

### 1.3 编写博客

#### 1.3.1 接口设计

| URL   | 请求类型 | 是否需要token |
| ----- | -------- | ------------- |
| /blog | POST     | 需要          |

#### 1.3.2 需求分析

传入blog，并从token中获取userId作为blogAuthorId，存入数据库中

传入tagIds数组，为博客增加Tag

#### 1.3.3 代码实现

### 1.4 编辑博客

#### 1.4.1 接口设计

| URL            | 请求类型 | 是否需要token |
| -------------- | -------- | ------------- |
| /blog/{blogId} | PUT      | 是            |

#### 1.4.2 需求分析

传入新的博客，更新数据库中的博客

### 1.5 点赞博客

#### 1.5.1 接口设计

| URL                 | 请求类型 | 是否需要token |
| ------------------- | -------- | ------------- |
| /blog/{blogId}/like | POST     | 是            |

#### 1.5.2 需求分析

增加点赞记录，并且博客的点赞数增加1

### 1.6 取消点赞博客

#### 1.6.1 接口设计

| URL                 | 请求类型 | 是否需要token |
| ------------------- | -------- | ------------- |
| /blog/{blogId}/like | DELETE   | 是            |

#### 1.6.2 需求分析

删除点赞记录，并且博客的点赞数减少1

### 1.7 点踩博客

#### 1.7.1 接口设计

| URL                    | 请求类型 | 是否需要token |
| ---------------------- | -------- | ------------- |
| /blog/{blogId}/dislike | POST     | 是            |

#### 1.7.1 需求分析

与点赞博客类似

### 1.8 取消点踩博客

#### 1.8.1 接口设计

| URL                    | 请求类型 | 是否需要token |
| ---------------------- | -------- | ------------- |
| /blog/{blogId}/dislike | DELETE   | 是            |

#### 1.8.1 需求分析

与取消点赞博客类似

### 1.9 收藏博客

#### 1.9.1 接口设计

| URL                    | 请求类型 | 是否需要token |
| ---------------------- | -------- | ------------- |
| /blog/{blogId}/collect | POST     | 是            |

### 1.10 取消收藏博客

#### 1.10.1 接口设计

| URL                    | 请求类型 | 是否需要token |
| ---------------------- | -------- | ------------- |
| /blog/{blogId}/collect | DELETE   | 是            |

### 1.11 删除博客

#### 1.11.1 接口设计

| URL            | 请求类型 | 是否需要token |
| -------------- | -------- | ------------- |
| /blog/{blogId} | DELETE   | 是            |

#### 1.11.2 需求分析

根据博客id删除博客

### 1.12 是否点赞过博客

#### 1.12.1 接口设计

| URL                 | 请求类型 | 是否需要token |
| ------------------- | -------- | ------------- |
| /blog/{blogId}/like | GET      | 是            |

#### 1.12.2 需求分析



### 1.13 是否点踩过博客

#### 1.13.1 接口设计

| URL                    | 请求类型 | 是否需要token |
| ---------------------- | -------- | ------------- |
| /blog/{blogId}/dislike | GET      | 是            |

#### 1.13.2 需求分析



### 1.14 删除博客

#### 1.14.1 接口设计

| URL                    | 请求类型 | 是否需要token |
| ---------------------- | -------- | ------------- |
| /blog/{blogId}/collect | GET      | 是            |

#### 1.14.2 需求分析



## 2 用户

### 2.1 登录

#### 2.1.1 接口设计

| URL    | 请求类型 | 是否需要token |
| ------ | -------- | ------------- |
| /login | POST     | 不需要        |

请求体

```json
{
    "userAccount":"lunar",
    "userPassword":"lunar"
}
```

相应格式
```json
{
    "code": 200,
    "data": {
        "token": "",
        "user": {
            "userId": 7,
            "userName": "lunar",
            "userFollowNumber": 0,
            "userFansNumber": 0,
            "userSignature": ""
        }
    },
    "msg": "操作成功"
}
```



#### 2.1.2 需求分析

利用Spring Security安全框架实现登录功能

登录

​	①自定义登录接口  

​				调用ProviderManager的方法进行认证 如果认证通过生成jwt

​				把用户信息存入redis中

​	②自定义UserDetailsService 

​				在这个实现类中去查询数据库

​	注意配置passwordEncoder为BCryptPasswordEncoder

校验：

​	①定义Jwt认证过滤器

​				获取token

​				解析token获取其中的userid

​				从redis中获取用户信息

​				存入SecurityContextHolder

#### 2.1.3 代码实现

### 2.2 登出

#### 2.2.1 接口设计

| URL     | 请求类型 | 是否需要token |
| ------- | -------- | ------------- |
| /logout | POST     | 需要          |

响应格式

```json
{
    "code": 200,
    "msg": "操作成功"
}
```



#### 2.2.2 需求分析

要实现的操作：

​	删除redis中的用户信息

#### 2.2.3 代码实现

### 2.3 注册

#### 2.3.1 接口设计

| URL       | 请求类型 | 是否需要token |
| --------- | -------- | ------------- |
| /register | POST     | 不需要        |

请求体

```json
{
    "userName":"lunar",
    "userAccount":"lunar",
    "userPassword":"lunar"
}
```

#### 2.3.2 需求分析

在用户表中增加新注册的用户，其中密码使用生成的token

#### 2.3.3 代码实现

### 2.4 首页查询用户信息

#### 2.4.1 接口设计

| URL            | 请求类型 | 是否需要token |
| -------------- | -------- | ------------- |
| /user/{userId} | GET      | 不需要        |

#### 2.4.2 需求分析

展示用户简略信息

- 用户编号
- 用户昵称
- 用户关注的人数
- 用户粉丝数
- 用户个性签名

#### 2.4.3 代码实现

### 2.5 用户信息详情

#### 2.5.1 接口设计

| URL                   | 请求类型 | 是否需要token |
| --------------------- | -------- | ------------- |
| /user/{userId}/detail | GET      | 不需要        |

#### 2.5.2 需求分析

展示用户详细信息

- 用户编号
- 用户账号
- 用户昵称
- 用户出生日期
- 用户个性签名
- 用户关注的人数
- 用户粉丝人数
- 用户文章数
- 用户权限
- 用户简介
- 用户所在地址

#### 2.5.3 代码实现

### 2.6 关注用户

#### 2.6.1 接口设计

| URL                   | 请求类型 | 是否需要token |
| --------------------- | -------- | ------------- |
| /user/{userId}/follow | POST     | 是            |

#### 2.6.2 需求分析



### 2.7 取消关注用户

#### 2.7.1 接口设计

| URL                   | 请求类型 | 是否需要token |
| --------------------- | -------- | ------------- |
| /user/{userId}/follow | DELETE   | 是            |

#### 2.7.2 需求分析



### 2.8 查看关注列表

#### 2.8.1 接口设计

| URL                        | 请求类型 | 是否需要token |
| -------------------------- | -------- | ------------- |
| /user/{userId}/follow/list | GET      | 不            |

#### 2.8.2 需求分析

分页查询 返回

### 2.9 查看粉丝列表

#### 2.9.1 接口设计

| URL                     | 请求类型 | 是否需要token |
| ----------------------- | -------- | ------------- |
| /user/{userId}/fan/list | GET      | 不            |



### 2.10 修改用户信息

#### 2.10.1 接口设计

| URL            | 请求类型 | 是否需要token |
| -------------- | -------- | ------------- |
| /user/{userId} | PUT      | 是            |

### 2.11 修改用户头像

#### 2.11.1 接口设计

| URL                   | 请求类型 | 是否需要token |
| --------------------- | -------- | ------------- |
| /user/{userId}/avatar | PUT      | 是            |



## 3 标签

### 3.1 查询标签下的所有公开博客

#### 3.1.1 接口设计

| URL               | 请求类型 | 是否需要token |
| ----------------- | -------- | ------------- |
| /tag/{tagId}/blog | GET      | 不需要        |

#### 3.1.2 需求分析

展示编号为{tagId}的标签下所有公开（可见性为0）博客

- 博客编号
- 博客作者编号
- 博客作者姓名
- 博客标题
- 博客摘要
- 博客的创建时间
- 博客的标签列表

分页查询，要求传入页数

#### 3.1.3 代码实现

### 3.2 查询所有标签列表

#### 3.2.1 接口设计

| URL  | 请求类型 | 是否需要token |
| ---- | -------- | ------------- |
| /tag | GET      | 不需要        |

#### 3.2.2 需求分析

展示所有标签的

- 标签编号
- 标签名称

#### 3.2.3 代码实现

## 4 评论

### 4.1 查看评论

#### 4.1.1 接口设计

| URL           | 请求类型 | 是否需要token |
| ------------- | -------- | ------------- |
| /comment/list | GET      | 不需要token   |

Query格式请求参数：

blogId:文章id

pageNumber: 页码

pageSize: 每页条数

#### 4.1.2 需求分析

相应格式

```json
{
    "code": 200,
    "data": {
        "rows": [
            {
                "articleId": "1",
                "children": [
                    {
                        "articleId": "1",
                        "content": "你说啥？",
                        "createBy": "1",
                        "createTime": "2022-01-30 10:06:21",
                        "id": "20",
                        "rootId": "1",
                        "toCommentId": "1",
                        "toCommentUserId": "1",
                        "toCommentUserName": "sg333",
                        "username": "sg333"
                    }
                ],
                "content": "asS",
                "createBy": "1",
                "createTime": "2022-01-29 07:59:22",
                "id": "1",
                "rootId": "-1",
                "toCommentId": "-1",
                "toCommentUserId": "-1",
                "username": "sg333"
            }
        ],
        "total": "15"
    },
    "msg": "操作成功"
}
```

#### 4.1.3 代码实现

### 4.2 发表评论

#### 4.2.1 接口设计

| URL      | 请求方式 | 是否需要token |
| -------- | -------- | ------------- |
| /comment | POST     | 是            |

Query格式请求参数：

```json
{
    "blogId":1,
    "commentParentId":1,
    "commentContent":""
}
```



#### 4.2.2 需求分析

#### 4.2.3 代码实现

### 4.3 删除评论

#### 4.3.1 接口设计

| URL                  | 请求方式 | 是否需要token |
| -------------------- | -------- | ------------- |
| /comment/{commentId} | DELETE   | 是            |



### 4.4 点赞评论

### 4.5 取消点赞评论

### 4.6 点踩评论

### 4.7 取消点踩评论

## 5 收藏夹

### 5.1 查看收藏夹列表

#### 5.1.1 接口设计

| URL          | 请求类型 | 是否需要token |
| ------------ | -------- | ------------- |
| /folder/list | GET      | 不需要        |

Query格式请求参数：

userId:用户id

pageNumber: 页码

pageSize: 每页条数

#### 5.1.2 需求分析

#### 5.1.3 代码实现

### 5.2 查看收藏夹所收藏的博客

#### 5.2.1 接口设计

| URL                | 请求类型 | 是否需要token |
| ------------------ | -------- | ------------- |
| /folder/{folderId} | GET      | 不需要        |

Query格式请求参数：

pageNumber: 页码

pageSize: 每页条数

#### 5.2.2 需求分析

返回收藏夹的基本信息和分页查询的博客列表

### 5.3 删除收藏夹

#### 5.3.1 接口设计

| URL                | 请求方式 | 是否需要token |
| ------------------ | -------- | ------------- |
| /folder/{folderId} | DELETE   | 是            |



### 5.4 重命名收藏夹

#### 5.4.1 接口设计

| URL                     | 请求方式 | 是否需要token |
| ----------------------- | -------- | ------------- |
| /folder/{folderId}/name | PUT      | 是            |



### 5.5 复制他人的收藏夹

#### 5.5.1 接口设计

| URL                     | 请求方式 | 是否需要token |
| ----------------------- | -------- | ------------- |
| /folder/{folderId}/copy | POST     | 是            |



### 5.6 新建收藏夹

#### 5.6.1 接口设计

| URL     | 请求方式 | 是否需要token |
| ------- | -------- | ------------- |
| /folder | POST     | 是            |



## 6 消息

### 6.1 查看消息列表

#### 6.1.1 接口设计

| URL                  | 请求类型 | 是否需要token |
| -------------------- | -------- | ------------- |
| /message/sender/list | GET      | 是            |

Query格式请求参数：

pageNumber: 页码

pageSize: 每页条数

#### 6.1.2 需求分析

返回用户所接收消息的发送者列表

### 6.2 查看用户与某用户的聊天记录

#### 6.2.1 接口设计

| URL           | 请求类型 | 是否需要token |
| ------------- | -------- | ------------- |
| /message/list |          |               |

Query格式请求参数：

userId:用户id

toId: 对象id

### 6.3 发送消息

## 7 文件相关

### 7.1 单个文件上传

#### 7.1.1 接口设计

| URL     | 请求类型 | 是否需要token |
| ------- | -------- | ------------- |
| /upload | POST     | 是            |



### 7.2 多个文件上传

#### 7.2.1 接口设计

| URL              | 请求类型 | 是否需要token |
| ---------------- | -------- | ------------- |
| /upload/multiple | POST     | 是            |



## 8 异常

### 8.1 统一异常处理
